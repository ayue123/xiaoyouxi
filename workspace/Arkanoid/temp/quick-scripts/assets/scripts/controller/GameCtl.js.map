{"version":3,"sources":["GameCtl.js"],"names":["GameModel","require","Ball","Slump","cc","Class","extends","Component","properties","gameView","paddle","brickLayout","overPanel","ballPrefab","Prefab","slumpPrefab","scoreAudio","default","type","AudioClip","collisionAudio","startBackGround","Node","wxSubContextView","wxBackGround","onLoad","physicsManager","director","getPhysicsManager","gameModel","updateGameModel","startGame","active","update","init","reBeginGame","enabled","initScore","initLevel","initLife","initLevelPosition","life","level","bricksNumber","getLevelPosition","getLevelSilveryPosition","updatePaddle","reInit","createNewBall","reInitLevelPosition","reStartGame","levelPosition","destroyAllBall","pauseGame","resumeGame","stopGame","show","score","surviveBricksNumber","setUserScorePassage","showReBegin","onBallContactBrick","ballNode","brickNode","parent","audioEngine","playEffect","destroy","addScore","minusSurviveBrick","updateScore","addLevel","destroyBall","updateLevel","dropBricks","i","length","pos","createSlump","position","onBallContactGround","groundNode","ballCount","reduceLife","updateLife","onBallContactPaddle","paddleNode","onBallContactWall","instantiate","node","getComponent","addBallCount","slumpNode","color","destroySlump","reduceBallCount","ballParentChildren","_children","_name","width","collider","PhysicsPolygonCollider","points","x","apply","paddleSchedule","schedule","updateBrick","updateBrickSensorTrue","brickSchedule","updateBrickSensorFalse","onBtnRank","initUserInfo","nickName","avatarUrl","a","wx","getOpenDataContext","postMessage","message","oldScore","getStorageSync","setStorageSync","setUserCloudStorage","KVDataList","key","value","success","console","log","res","openDataContext","fail","e","onBtnBack"],"mappings":"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","file":"GameCtl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["const GameModel = require('GameModel');\r\nvar Ball = require(\"Ball\");\r\nconst Slump = require('Slump');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameView: require('GameView'),\r\n        paddle: require('Paddle'),\r\n        brickLayout: require('BrickLayout'),\r\n        overPanel: require('OverPanel'),\r\n        ballPrefab: cc.Prefab,\r\n        slumpPrefab: cc.Prefab,\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        // 跳跃音效资源\r\n        collisionAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        startBackGround:cc.Node,\r\n        wxSubContextView: cc.Node,\r\n        wxBackGround:cc.Node,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        this.gameModel = new GameModel();\r\n        this.overPanel.updateGameModel(this.gameModel);\r\n        this.startGame();\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n    update:function () {\r\n\r\n    },\r\n\r\n\r\n    startGame(){\r\n        this.init();\r\n        this.reBeginGame();\r\n    },\r\n    //部分属性初始化（游戏初始化时调用）\r\n    init() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameModel.init();\r\n        this.gameModel.initScore();\r\n        this.gameModel.initLevel();\r\n        this.gameModel.initLife();\r\n        this.gameModel.initLevelPosition();\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initScore();\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.paddle.init();\r\n        this.brickLayout.init(this.gameModel.bricksNumber,this.gameModel.getLevelPosition(),this.gameModel.getLevelSilveryPosition());\r\n        this.overPanel.init(this);\r\n        this.updatePaddle(true);\r\n    },\r\n    //部分属性重新初始化（在玩家仍然有机会时初始化调用）\r\n    reInit(){\r\n        this.physicsManager.enabled = true;\r\n        this.gameView.init(this);\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.createNewBall();\r\n        this.paddle.init();\r\n        this.overPanel.init(this);\r\n        this.updatePaddle(true);\r\n    },\r\n    //重新绘制关卡\r\n    reInitLevelPosition(){\r\n        this.brickLayout.init(this.gameModel.bricksNumber,this.gameModel.getLevelPosition(),this.gameModel.getLevelSilveryPosition());\r\n    },\r\n    //重新开始游戏，用于还有机会的情况下\r\n    reStartGame(levelPosition){\r\n        this.destroyAllBall();\r\n        this.reInit(levelPosition);\r\n        this.startBackGround.active = false;\r\n    },\r\n    pauseGame() {\r\n        this.physicsManager.enabled = false;\r\n    },\r\n\r\n    resumeGame() {\r\n        this.physicsManager.enabled = true;\r\n    },\r\n    //结束游戏\r\n    stopGame() {\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.show(this.gameModel.score, this.gameModel.surviveBricksNumber === 0,this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //重新开始游戏（在玩家还有机会时调用）\r\n    reBeginGame(){\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.showReBegin(this.gameModel.score, this.gameModel.life,this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //小球撞击砖块处理\r\n    onBallContactBrick(ballNode, brickNode) {\r\n        //处理因为并发问题引起的砖块未打干净而结束计数的bug\r\n        if(brickNode.parent == null){\r\n            return;\r\n        }\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        if(brickNode.life>1){\r\n            brickNode.life = brickNode.life-1;\r\n        }else{\r\n            brickNode.parent = null;\r\n            brickNode.destroy();\r\n            this.gameModel.addScore(1);\r\n            // this.gameModel.minusBrick(1);\r\n            this.gameModel.minusSurviveBrick(1);\r\n            this.gameView.updateScore(this.gameModel.score);\r\n            //本关结束\r\n            if (this.gameModel.surviveBricksNumber <= 0) {\r\n                this.gameModel.addLevel();\r\n                this.overPanel.updateGameModel(this.gameModel);\r\n                this.destroyBall(ballNode);\r\n                this.reBeginGame();\r\n                this.destroyAllBall();\r\n                this.gameView.updateLevel(this.gameModel.level);\r\n            }\r\n            var dropBricks =  this.gameModel.dropBricks;\r\n            for(var i = 0;i<dropBricks.length;i++){\r\n                if(brickNode.pos == dropBricks[i] ){\r\n                    this.createSlump(brickNode.position,i);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //小球撞击地板处理\r\n    onBallContactGround(ballNode, groundNode) {\r\n        if(this.gameModel.ballCount<=1){\r\n            if(this.gameModel.life>1 && this.gameModel.surviveBricksNumber > 0){\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n            } else{\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.stopGame();\r\n            }\r\n            this.destroyBall(ballNode);\r\n        }else{\r\n            this.destroyBall(ballNode);\r\n        }\r\n    },\r\n    //小球撞击托盘播放音效\r\n    onBallContactPaddle(ballNode, paddleNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //小球撞击墙壁播放音效\r\n    onBallContactWall(ballNode, brickNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //创建新的小球\r\n    createNewBall(){\r\n        //小球复制代码\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        ballNode.parent = this.paddle.node.parent;\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.init(this,this.paddle.node.position);\r\n        this.gameModel.addBallCount();\r\n    },\r\n    //创建掉落砖块\r\n    createSlump(position,i){\r\n        var slumpNode = cc.instantiate(this.slumpPrefab);\r\n        slumpNode.parent = this.brickLayout.node;\r\n        var Slump = slumpNode.getComponent('Slump')\r\n        if(i%3 ==1){\r\n            slumpNode.color = cc.color(255,0,0);//红\r\n            slumpNode.type = 1;\r\n        }else if(i%3 ==2){\r\n            slumpNode.color = cc.color(0,255,255);//绿\r\n            slumpNode.type = 2;\r\n        }else{\r\n            slumpNode.type = 0;\r\n        }\r\n        Slump.init(this,position);\r\n    },\r\n    //销毁掉落砖块\r\n    destroySlump(slumpNode){\r\n        slumpNode.destroy();\r\n    },\r\n\r\n    //销毁单个小球（小球撞击地板时调用）\r\n    destroyBall(ballNode){\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n        this.gameModel.reduceBallCount();\r\n    },\r\n    //销毁全部小球（游戏结束时调用）\r\n    destroyAllBall(){\r\n        var ballParentChildren = this.paddle.node.parent._children;\r\n        for (var i= 0;i<ballParentChildren.length;i++){\r\n            var node = ballParentChildren[i];\r\n            if(node._name == \"ball\"){\r\n                this.destroyBall(node);\r\n            }\r\n        }\r\n    },\r\n    //更换托盘\r\n    updatePaddle(active){\r\n        if (active == true){\r\n            if(this.paddle.node.width<100){\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for(let i = 0;i<collider.points.length;i++){\r\n                    collider.points[i].x = collider.points[i].x*2;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width*2\r\n            }\r\n        }else{\r\n            if(this.paddle.node.width>100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 2;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width /2\r\n                this.paddleSchedule();\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleSchedule(){\r\n        this.schedule(function() {\r\n            this.updatePaddle(true);\r\n        }, 5);\r\n    },\r\n    //更新砖块为有碰撞回调，有无碰撞效果\r\n    updateBrick(active){\r\n        if(active == true){\r\n            this.brickLayout.updateBrickSensorTrue();\r\n            this.brickSchedule();\r\n        }else{\r\n            this.brickLayout.updateBrickSensorFalse()\r\n        }\r\n    },\r\n    //砖块碰撞效果恢复计时器\r\n    brickSchedule(){\r\n        this.schedule(function() {\r\n            this.updateBrick(false);\r\n        }, 5);\r\n    },\r\n\r\n\r\n    //排行榜按钮\r\n    onBtnRank(){\r\n        this.initUserInfo()\r\n    },\r\n    //初始化玩家排行榜\r\n    initUserInfo(nickName,avatarUrl){\r\n        //权限按钮\r\n        // if(this.nickName.string == \"nickName\"){\r\n        //     let systemInfo = wx.getSystemInfoSync();\r\n        //     let width = systemInfo.windowWidth;\r\n        //     let height = systemInfo.windowHeight;\r\n        // const button = wx.createUserInfoButton({\r\n        //     type: 'text',\r\n        //     text: '',\r\n        //     style: {\r\n        //         left: 0,\r\n        //         top: 0,\r\n        //         width: width,\r\n        //         height: height,\r\n        //         lineHeight: 40,\r\n        //         backgroundColor: '#00000000',\r\n        //         color: '#00000000',\r\n        //         textAlign: 'center',\r\n        //         fontSize: 10,\r\n        //         borderRadius: 4\r\n        //     }\r\n        // })\r\n        //\r\n        // button.onTap((res) => {\r\n        //     let userInfo = res.userInfo;\r\n        //     this.nickName.string = userInfo.nickName;\r\n        //     cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\r\n        //         if (err) {\r\n        //             console.error(err);\r\n        //             return;\r\n        //         }\r\n        //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\r\n        //     });\r\n        //     button.hide();\r\n        //     button.destroy();\r\n        //\r\n        // })\r\n        // }\r\n\r\n        this.wxSubContextView.active = true;\r\n        this.wxBackGround.active = true;\r\n        let a = wx.getOpenDataContext().postMessage({\r\n            message: \"User info get success.\"\r\n        });\r\n    },\r\n    //上传玩家得分\r\n    setUserScorePassage(score){\r\n        try {\r\n            const oldScore = wx.getStorageSync('maxScore')||0;\r\n                if(oldScore<score){\r\n                    try {\r\n                        wx.setStorageSync('maxScore',score);\r\n                        wx.setUserCloudStorage({\r\n                            KVDataList: [{ key: \"score\", value: score+\"\" }],\r\n                            success: res => {\r\n                                console.log(res);\r\n                                // 让子域更新当前用户的最高分，因为主域无法得到getUserCloadStorage;\r\n                                let openDataContext = wx.getOpenDataContext();\r\n                                openDataContext.postMessage({\r\n                                    type: 'updateMaxScore',\r\n                                });\r\n                            },\r\n                            fail: res => {\r\n                                console.log(res);\r\n                            }\r\n                        });\r\n                    } catch (e) {\r\n                        console.log(\"数据存储失败\")\r\n                    }\r\n                }\r\n        } catch (e) {\r\n            console.log(\"获取数据存储失败\")\r\n        }\r\n    },\r\n\r\n    //排行榜返回按钮\r\n    onBtnBack(){\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n\r\n\r\n});"]}