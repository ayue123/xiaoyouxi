{"version":3,"sources":["GameCtl.js"],"names":["GameModel","require","Ball","Slump","cc","Class","extends","Component","properties","gameView","paddle","brickLayout","overPanel","ballPrefab","Prefab","slumpPrefab","scoreAudio","default","type","AudioClip","collisionAudio","startBackGround","Node","wxSubContextView","wxBackGround","onLoad","physicsManager","director","getPhysicsManager","gameModel","init","updateGameModel","reBeginGame","active","startGame","enabled","initScore","initLevel","initLife","initLevelPosition","life","bricksNumber","levelOnePosition","reInit","createNewBall","reInitLevelPosition","levelPosition","reStartGame","destroyAllBall","pauseGame","resumeGame","stopGame","show","score","surviveBricksNumber","setUserScorePassage","showReBegin","onBallContactBrick","ballNode","brickNode","parent","audioEngine","playEffect","destroy","addScore","minusSurviveBrick","updateScore","addLevel","destroyBall","dropBricks","i","length","pos","createSlump","position","onBallContactGround","groundNode","ballCount","reduceLife","updateLife","onBallContactPaddle","paddleNode","onBallContactWall","instantiate","node","getComponent","addBallCount","slumpNode","destroySlump","reduceBallCount","ballParentChildren","_children","_name","onBtnRank","initUserInfo","nickName","avatarUrl","a","wx","getOpenDataContext","postMessage","message","oldScore","getStorageSync","setStorageSync","setUserCloudStorage","KVDataList","key","value","success","console","log","res","openDataContext","fail","e","onBtnBack"],"mappings":";;;;;;AAAA,IAAMA,YAAYC,QAAQ,WAAR,CAAlB;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;AACAG,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,kBAAUR,QAAQ,UAAR,CADF;AAERS,gBAAQT,QAAQ,QAAR,CAFA;AAGRU,qBAAaV,QAAQ,aAAR,CAHL;AAIRW,mBAAWX,QAAQ,WAAR,CAJH;AAKRY,oBAAYT,GAAGU,MALP;AAMRC,qBAAaX,GAAGU,MANR;AAOR;AACAE,oBAAY;AACRC,qBAAS,IADD;AAERC,kBAAMd,GAAGe;AAFD,SARJ;AAYR;AACAC,wBAAgB;AACZH,qBAAS,IADG;AAEZC,kBAAMd,GAAGe;AAFG,SAbR;AAiBRE,yBAAgBjB,GAAGkB,IAjBX;AAkBRC,0BAAkBnB,GAAGkB,IAlBb;AAmBRE,sBAAapB,GAAGkB;AAnBR,KAHP;;AAyBLG,YAAQ,kBAAY;AAChB,aAAKC,cAAL,GAAsBtB,GAAGuB,QAAH,CAAYC,iBAAZ,EAAtB;AACA,aAAKC,SAAL,GAAiB,IAAI7B,SAAJ,EAAjB;AACA,aAAK8B,IAAL;AACA,aAAKlB,SAAL,CAAemB,eAAf,CAA+B,KAAKF,SAApC;AACA,aAAKG,WAAL;AACA,aAAKT,gBAAL,CAAsBU,MAAtB,GAA+B,KAA/B;AACA,aAAKT,YAAL,CAAkBS,MAAlB,GAA2B,KAA3B;AAEH,KAlCI;;AAoCLC,aApCK,uBAoCM;AACP,aAAKJ,IAAL;AACA,aAAKE,WAAL;AACH,KAvCI;;AAwCL;AACAF,QAzCK,kBAyCE;AACH,aAAKJ,cAAL,CAAoBS,OAApB,GAA8B,IAA9B;AACA,aAAKN,SAAL,CAAeC,IAAf;AACA,aAAKD,SAAL,CAAeO,SAAf;AACA,aAAKP,SAAL,CAAeQ,SAAf;AACA,aAAKR,SAAL,CAAeS,QAAf;AACA,aAAKT,SAAL,CAAeU,iBAAf;AACA,aAAK9B,QAAL,CAAcqB,IAAd,CAAmB,IAAnB;AACA,aAAKrB,QAAL,CAAc6B,QAAd,CAAuB,KAAKT,SAAL,CAAeW,IAAtC;AACA,aAAK/B,QAAL,CAAc2B,SAAd;AACA,aAAK1B,MAAL,CAAYoB,IAAZ;AACA,aAAKnB,WAAL,CAAiBmB,IAAjB,CAAsB,KAAKD,SAAL,CAAeY,YAArC,EAAkD,KAAKZ,SAAL,CAAea,gBAAjE;AACA,aAAK9B,SAAL,CAAekB,IAAf,CAAoB,IAApB;AAEH,KAvDI;;AAwDL;AACAa,UAzDK,oBAyDG;AACJ,aAAKjB,cAAL,CAAoBS,OAApB,GAA8B,IAA9B;AACA,aAAK1B,QAAL,CAAcqB,IAAd,CAAmB,IAAnB;AACA,aAAKrB,QAAL,CAAcqB,IAAd,CAAmB,IAAnB;AACA,aAAKrB,QAAL,CAAc6B,QAAd,CAAuB,KAAKT,SAAL,CAAeW,IAAtC;AACA,aAAKI,aAAL;AACA,aAAKlC,MAAL,CAAYoB,IAAZ;AACA,aAAKlB,SAAL,CAAekB,IAAf,CAAoB,IAApB;AACH,KAjEI;AAmELe,uBAnEK,+BAmEeC,aAnEf,EAmE6B;AAC9B,aAAKnC,WAAL,CAAiBmB,IAAjB,CAAsB,KAAKD,SAAL,CAAeY,YAArC,EAAkDK,aAAlD;AACH,KArEI;AAuELC,eAvEK,uBAuEOD,aAvEP,EAuEqB;AACtB,aAAKE,cAAL;AACA,aAAKL,MAAL,CAAYG,aAAZ;AACA,aAAKzB,eAAL,CAAqBY,MAArB,GAA8B,KAA9B;AACH,KA3EI;AA4ELgB,aA5EK,uBA4EO;AACR,aAAKvB,cAAL,CAAoBS,OAApB,GAA8B,KAA9B;AACH,KA9EI;AAgFLe,cAhFK,wBAgFQ;AACT,aAAKxB,cAAL,CAAoBS,OAApB,GAA8B,IAA9B;AACH,KAlFI;;AAmFL;AACAgB,YApFK,sBAoFM;AACP,aAAKzB,cAAL,CAAoBS,OAApB,GAA8B,KAA9B;AACA,aAAKvB,SAAL,CAAewC,IAAf,CAAoB,KAAKvB,SAAL,CAAewB,KAAnC,EAA0C,KAAKxB,SAAL,CAAeyB,mBAAf,KAAuC,CAAjF;AACA,aAAKjC,eAAL,CAAqBY,MAArB,GAA8B,IAA9B;AACA,aAAKsB,mBAAL,CAAyB,KAAK1B,SAAL,CAAewB,KAAxC;AACH,KAzFI;;AA0FL;AACArB,eA3FK,yBA2FQ;AACT,aAAKN,cAAL,CAAoBS,OAApB,GAA8B,KAA9B;AACA,aAAKvB,SAAL,CAAe4C,WAAf,CAA2B,KAAK3B,SAAL,CAAewB,KAA1C,EAAiD,KAAKxB,SAAL,CAAeW,IAAhE;AACA,aAAKnB,eAAL,CAAqBY,MAArB,GAA8B,IAA9B;AACA,aAAKsB,mBAAL,CAAyB,KAAK1B,SAAL,CAAewB,KAAxC;AACH,KAhGI;;AAiGL;AACAI,sBAlGK,8BAkGcC,QAlGd,EAkGwBC,SAlGxB,EAkGmC;;AAEpC;AACA,YAAGA,UAAUC,MAAV,IAAoB,IAAvB,EAA4B;AACxB;AACH;AACD;AACAxD,WAAGyD,WAAH,CAAeC,UAAf,CAA0B,KAAK9C,UAA/B,EAA2C,KAA3C;AACA2C,kBAAUC,MAAV,GAAmB,IAAnB;AACAD,kBAAUI,OAAV;AACA,aAAKlC,SAAL,CAAemC,QAAf,CAAwB,CAAxB;AACA;AACA,aAAKnC,SAAL,CAAeoC,iBAAf,CAAiC,CAAjC;AACA,aAAKxD,QAAL,CAAcyD,WAAd,CAA0B,KAAKrC,SAAL,CAAewB,KAAzC;AACA;AACA,YAAI,KAAKxB,SAAL,CAAeyB,mBAAf,IAAsC,CAA1C,EAA6C;AACzC,iBAAKzB,SAAL,CAAesC,QAAf;AACA,iBAAKvD,SAAL,CAAemB,eAAf,CAA+B,KAAKF,SAApC;AACA,iBAAKuC,WAAL,CAAiBV,QAAjB;AACA,iBAAK1B,WAAL;AACA,iBAAKgB,cAAL;AACH;AACD,YAAIqB,aAAc,KAAKxC,SAAL,CAAewC,UAAjC;AACA,aAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAED,WAAWE,MAA3B,EAAkCD,GAAlC,EAAsC;AAClC,gBAAGX,UAAUa,GAAV,IAAiBH,WAAWC,CAAX,CAApB,EAAmC;AAC/B,qBAAKG,WAAL,CAAiBd,UAAUe,QAA3B;AACA;AACH;AACJ;AACJ,KA/HI;;;AAiIL;AACAC,uBAlIK,+BAkIejB,QAlIf,EAkIyBkB,UAlIzB,EAkIqC;AACtC,YAAG,KAAK/C,SAAL,CAAegD,SAAf,IAA0B,CAA7B,EAA+B;AAC3B,gBAAG,KAAKhD,SAAL,CAAeW,IAAf,GAAoB,CAApB,IAAyB,KAAKX,SAAL,CAAeyB,mBAAf,GAAqC,CAAjE,EAAmE;AAC/D,qBAAKzB,SAAL,CAAeiD,UAAf;AACA,qBAAKrE,QAAL,CAAcsE,UAAd,CAAyB,KAAKlD,SAAL,CAAeW,IAAxC;AACA,qBAAK5B,SAAL,CAAemB,eAAf,CAA+B,KAAKF,SAApC;AACA,qBAAKG,WAAL;AACH,aALD,MAKM;AACF,qBAAKH,SAAL,CAAeiD,UAAf;AACA,qBAAKrE,QAAL,CAAcsE,UAAd,CAAyB,KAAKlD,SAAL,CAAeW,IAAxC;AACA,qBAAK5B,SAAL,CAAemB,eAAf,CAA+B,KAAKF,SAApC;AACA,qBAAKsB,QAAL;AACH;AACD,iBAAKiB,WAAL,CAAiBV,QAAjB;AACH,SAbD,MAaK;AACD,iBAAKU,WAAL,CAAiBV,QAAjB;AACH;AACJ,KAnJI;;AAoJL;AACAsB,uBArJK,+BAqJetB,QArJf,EAqJyBuB,UArJzB,EAqJqC;AACtC;AACA7E,WAAGyD,WAAH,CAAeC,UAAf,CAA0B,KAAK1C,cAA/B,EAA+C,KAA/C;AACH,KAxJI;;AAyJL;AACA8D,qBA1JK,6BA0JaxB,QA1Jb,EA0JuBC,SA1JvB,EA0JkC;AACnC;AACAvD,WAAGyD,WAAH,CAAeC,UAAf,CAA0B,KAAK1C,cAA/B,EAA+C,KAA/C;AACH,KA7JI;;AA8JL;AACAwB,iBA/JK,2BA+JU;AACX;AACA,YAAIc,WAAWtD,GAAG+E,WAAH,CAAe,KAAKtE,UAApB,CAAf;AACA6C,iBAASE,MAAT,GAAkB,KAAKlD,MAAL,CAAY0E,IAAZ,CAAiBxB,MAAnC;AACA,YAAI1D,OAAOwD,SAAS2B,YAAT,CAAsB,MAAtB,CAAX;AACAnF,aAAK4B,IAAL,CAAU,IAAV,EAAe,KAAKpB,MAAL,CAAY0E,IAAZ,CAAiBV,QAAhC;AACA,aAAK7C,SAAL,CAAeyD,YAAf;AACH,KAtKI;;AAuKL;AACAb,eAxKK,uBAwKOC,QAxKP,EAwKgB;AACjB,YAAIa,YAAYnF,GAAG+E,WAAH,CAAe,KAAKpE,WAApB,CAAhB;AACAwE,kBAAU3B,MAAV,GAAmB,KAAKjD,WAAL,CAAiByE,IAApC;AACA,YAAIjF,QAAQoF,UAAUF,YAAV,CAAuB,OAAvB,CAAZ;AACAlF,cAAM2B,IAAN,CAAW,IAAX,EAAgB4C,QAAhB;AACH,KA7KI;;AA8KL;AACAc,gBA/KK,wBA+KQD,SA/KR,EA+KkB;AACnBA,kBAAUxB,OAAV;AACH,KAjLI;;;AAmLL;AACAK,eApLK,uBAoLOV,QApLP,EAoLgB;AACjBA,iBAASE,MAAT,GAAkB,IAAlB;AACAF,iBAASK,OAAT;AACA,aAAKlC,SAAL,CAAe4D,eAAf;AACH,KAxLI;;AAyLL;AACAzC,kBA1LK,4BA0LW;AACZ,YAAI0C,qBAAqB,KAAKhF,MAAL,CAAY0E,IAAZ,CAAiBxB,MAAjB,CAAwB+B,SAAjD;AACA,aAAK,IAAIrB,IAAG,CAAZ,EAAcA,IAAEoB,mBAAmBnB,MAAnC,EAA0CD,GAA1C,EAA8C;AAC1C,gBAAIc,OAAOM,mBAAmBpB,CAAnB,CAAX;AACA,gBAAGc,KAAKQ,KAAL,IAAc,MAAjB,EAAwB;AACpB,qBAAKxB,WAAL,CAAiBgB,IAAjB;AACH;AACJ;AACJ,KAlMI;;;AAoML;AACAS,aArMK,uBAqMM;AACP,aAAKC,YAAL;AACH,KAvMI;;AAwML;AACAA,gBAzMK,wBAyMQC,QAzMR,EAyMiBC,SAzMjB,EAyM2B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAKzE,gBAAL,CAAsBU,MAAtB,GAA+B,IAA/B;AACA,aAAKT,YAAL,CAAkBS,MAAlB,GAA2B,IAA3B;AACA,YAAIgE,IAAIC,GAAGC,kBAAH,GAAwBC,WAAxB,CAAoC;AACxCC,qBAAS;AAD+B,SAApC,CAAR;AAGH,KArPI;;AAsPL;AACA9C,uBAvPK,+BAuPeF,KAvPf,EAuPqB;AACtB,YAAI;AACA,gBAAMiD,WAAWJ,GAAGK,cAAH,CAAkB,UAAlB,KAA+B,CAAhD;AACI,gBAAGD,WAASjD,KAAZ,EAAkB;AACd,oBAAI;AACA6C,uBAAGM,cAAH,CAAkB,UAAlB,EAA6BnD,KAA7B;AACA6C,uBAAGO,mBAAH,CAAuB;AACnBC,oCAAY,CAAC,EAAEC,KAAK,OAAP,EAAgBC,OAAOvD,QAAM,EAA7B,EAAD,CADO;AAEnBwD,iCAAS,sBAAO;AACZC,oCAAQC,GAAR,CAAYC,GAAZ;AACA;AACA,gCAAIC,kBAAkBf,GAAGC,kBAAH,EAAtB;AACAc,4CAAgBb,WAAhB,CAA4B;AACxBlF,sCAAM;AADkB,6BAA5B;AAGH,yBATkB;AAUnBgG,8BAAM,mBAAO;AACTJ,oCAAQC,GAAR,CAAYC,GAAZ;AACH;AAZkB,qBAAvB;AAcH,iBAhBD,CAgBE,OAAOG,CAAP,EAAU;AACRL,4BAAQC,GAAR,CAAY,QAAZ;AACH;AACJ;AACR,SAvBD,CAuBE,OAAOI,CAAP,EAAU;AACRL,oBAAQC,GAAR,CAAY,UAAZ;AACH;AACJ,KAlRI;;;AAoRL;AACAK,aArRK,uBAqRM;AACP,aAAK7F,gBAAL,CAAsBU,MAAtB,GAA+B,KAA/B;AACA,aAAKT,YAAL,CAAkBS,MAAlB,GAA2B,KAA3B;AACH;AAxRI,CAAT","file":"GameCtl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["const GameModel = require('GameModel');\r\nvar Ball = require(\"Ball\");\r\nconst Slump = require('Slump');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameView: require('GameView'),\r\n        paddle: require('Paddle'),\r\n        brickLayout: require('BrickLayout'),\r\n        overPanel: require('OverPanel'),\r\n        ballPrefab: cc.Prefab,\r\n        slumpPrefab: cc.Prefab,\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        // 跳跃音效资源\r\n        collisionAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        startBackGround:cc.Node,\r\n        wxSubContextView: cc.Node,\r\n        wxBackGround:cc.Node,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        this.gameModel = new GameModel();\r\n        this.init();\r\n        this.overPanel.updateGameModel(this.gameModel);\r\n        this.reBeginGame();\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n\r\n    },\r\n\r\n    startGame(){\r\n        this.init();\r\n        this.reBeginGame();\r\n    },\r\n    //部分属性初始化（游戏初始化时调用）\r\n    init() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameModel.init();\r\n        this.gameModel.initScore();\r\n        this.gameModel.initLevel();\r\n        this.gameModel.initLife();\r\n        this.gameModel.initLevelPosition();\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initScore();\r\n        this.paddle.init();\r\n        this.brickLayout.init(this.gameModel.bricksNumber,this.gameModel.levelOnePosition);\r\n        this.overPanel.init(this);\r\n\r\n    },\r\n    //部分属性重新初始化（在玩家仍然有机会时初始化调用）\r\n    reInit(){\r\n        this.physicsManager.enabled = true;\r\n        this.gameView.init(this);\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.createNewBall();\r\n        this.paddle.init();\r\n        this.overPanel.init(this);\r\n    },\r\n\r\n    reInitLevelPosition(levelPosition){\r\n        this.brickLayout.init(this.gameModel.bricksNumber,levelPosition);\r\n    },\r\n\r\n    reStartGame(levelPosition){\r\n        this.destroyAllBall();\r\n        this.reInit(levelPosition);\r\n        this.startBackGround.active = false;\r\n    },\r\n    pauseGame() {\r\n        this.physicsManager.enabled = false;\r\n    },\r\n\r\n    resumeGame() {\r\n        this.physicsManager.enabled = true;\r\n    },\r\n    //结束游戏\r\n    stopGame() {\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.show(this.gameModel.score, this.gameModel.surviveBricksNumber === 0);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //重新开始游戏（在玩家还有机会时调用）\r\n    reBeginGame(){\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.showReBegin(this.gameModel.score, this.gameModel.life);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //小球撞击砖块处理\r\n    onBallContactBrick(ballNode, brickNode) {\r\n\r\n        //处理因为并发问题引起的砖块未打干净而结束计数的bug\r\n        if(brickNode.parent == null){\r\n            return;\r\n        }\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        brickNode.parent = null;\r\n        brickNode.destroy();\r\n        this.gameModel.addScore(1);\r\n        // this.gameModel.minusBrick(1);\r\n        this.gameModel.minusSurviveBrick(1);\r\n        this.gameView.updateScore(this.gameModel.score);\r\n        //本关结束\r\n        if (this.gameModel.surviveBricksNumber <= 0) {\r\n            this.gameModel.addLevel();\r\n            this.overPanel.updateGameModel(this.gameModel);\r\n            this.destroyBall(ballNode);\r\n            this.reBeginGame();\r\n            this.destroyAllBall();\r\n        }\r\n        var dropBricks =  this.gameModel.dropBricks;\r\n        for(var i = 0;i<dropBricks.length;i++){\r\n            if(brickNode.pos == dropBricks[i] ){\r\n                this.createSlump(brickNode.position);\r\n                break;\r\n            }\r\n        }\r\n    },\r\n\r\n    //小球撞击地板处理\r\n    onBallContactGround(ballNode, groundNode) {\r\n        if(this.gameModel.ballCount<=1){\r\n            if(this.gameModel.life>1 && this.gameModel.surviveBricksNumber > 0){\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n            } else{\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.stopGame();\r\n            }\r\n            this.destroyBall(ballNode);\r\n        }else{\r\n            this.destroyBall(ballNode);\r\n        }\r\n    },\r\n    //小球撞击托盘播放音效\r\n    onBallContactPaddle(ballNode, paddleNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //小球撞击墙壁播放音效\r\n    onBallContactWall(ballNode, brickNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //创建新的小球\r\n    createNewBall(){\r\n        //小球复制代码\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        ballNode.parent = this.paddle.node.parent;\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.init(this,this.paddle.node.position);\r\n        this.gameModel.addBallCount();\r\n    },\r\n    //创建掉落砖块\r\n    createSlump(position){\r\n        var slumpNode = cc.instantiate(this.slumpPrefab);\r\n        slumpNode.parent = this.brickLayout.node;\r\n        var Slump = slumpNode.getComponent('Slump')\r\n        Slump.init(this,position);\r\n    },\r\n    //销毁掉落砖块\r\n    destroySlump(slumpNode){\r\n        slumpNode.destroy();\r\n    },\r\n\r\n    //销毁单个小球（小球撞击地板时调用）\r\n    destroyBall(ballNode){\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n        this.gameModel.reduceBallCount();\r\n    },\r\n    //销毁全部小球（游戏结束时调用）\r\n    destroyAllBall(){\r\n        var ballParentChildren = this.paddle.node.parent._children;\r\n        for (var i= 0;i<ballParentChildren.length;i++){\r\n            var node = ballParentChildren[i];\r\n            if(node._name == \"ball\"){\r\n                this.destroyBall(node);\r\n            }\r\n        }\r\n    },\r\n\r\n    //排行榜按钮\r\n    onBtnRank(){\r\n        this.initUserInfo()\r\n    },\r\n    //初始化玩家排行榜\r\n    initUserInfo(nickName,avatarUrl){\r\n        //权限按钮\r\n        // if(this.nickName.string == \"nickName\"){\r\n        //     let systemInfo = wx.getSystemInfoSync();\r\n        //     let width = systemInfo.windowWidth;\r\n        //     let height = systemInfo.windowHeight;\r\n        // const button = wx.createUserInfoButton({\r\n        //     type: 'text',\r\n        //     text: '',\r\n        //     style: {\r\n        //         left: 0,\r\n        //         top: 0,\r\n        //         width: width,\r\n        //         height: height,\r\n        //         lineHeight: 40,\r\n        //         backgroundColor: '#00000000',\r\n        //         color: '#00000000',\r\n        //         textAlign: 'center',\r\n        //         fontSize: 10,\r\n        //         borderRadius: 4\r\n        //     }\r\n        // })\r\n        //\r\n        // button.onTap((res) => {\r\n        //     let userInfo = res.userInfo;\r\n        //     this.nickName.string = userInfo.nickName;\r\n        //     cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\r\n        //         if (err) {\r\n        //             console.error(err);\r\n        //             return;\r\n        //         }\r\n        //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\r\n        //     });\r\n        //     button.hide();\r\n        //     button.destroy();\r\n        //\r\n        // })\r\n        // }\r\n\r\n        this.wxSubContextView.active = true;\r\n        this.wxBackGround.active = true;\r\n        let a = wx.getOpenDataContext().postMessage({\r\n            message: \"User info get success.\"\r\n        });\r\n    },\r\n    //上传玩家得分\r\n    setUserScorePassage(score){\r\n        try {\r\n            const oldScore = wx.getStorageSync('maxScore')||0;\r\n                if(oldScore<score){\r\n                    try {\r\n                        wx.setStorageSync('maxScore',score);\r\n                        wx.setUserCloudStorage({\r\n                            KVDataList: [{ key: \"score\", value: score+\"\" }],\r\n                            success: res => {\r\n                                console.log(res);\r\n                                // 让子域更新当前用户的最高分，因为主域无法得到getUserCloadStorage;\r\n                                let openDataContext = wx.getOpenDataContext();\r\n                                openDataContext.postMessage({\r\n                                    type: 'updateMaxScore',\r\n                                });\r\n                            },\r\n                            fail: res => {\r\n                                console.log(res);\r\n                            }\r\n                        });\r\n                    } catch (e) {\r\n                        console.log(\"数据存储失败\")\r\n                    }\r\n                }\r\n        } catch (e) {\r\n            console.log(\"获取数据存储失败\")\r\n        }\r\n    },\r\n\r\n    //排行榜返回按钮\r\n    onBtnBack(){\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n\r\n\r\n});"]}