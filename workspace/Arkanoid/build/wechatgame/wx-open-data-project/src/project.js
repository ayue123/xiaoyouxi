window.__require=function e(n,t,r){function i(o,c){if(!t[o]){if(!n[o]){var s=o.split("/");if(s=s[s.length-1],!n[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+o+"'")}}var f=t[o]={exports:{}};n[o][0].call(f.exports,function(e){return i(n[o][1][e]||e)},f,f.exports,e,n,t,r)}return t[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<r.length;o++)i(r[o]);return i}({launch:[function(e,n,t){"use strict";cc._RF.push(n,"e53e6YiUd9FJLf8yIQu1n47","launch"),cc.Class({extends:cc.Component,properties:{content:cc.Node,prefab:cc.Prefab,userRankInfo:cc.Node},start:function(){var e=this;"undefined"!=typeof wx&&wx.onMessage(function(n){for(var t=0;t<e.content.children.length;t++){e.content.children[t].destroy()}n.message&&(console.log(n.message),e.initTips(),e.initUserScoreInfo(),e.initFriendRankInfo()),"updateMaxScore"==n.type&&e.updateUserMaxScore})},initTips:function(){cc.game.renderType,cc.game.RENDER_TYPE_WEBGL},updateUserMaxScore:function(){this.userRankInfo.children.destroy()},initUserInfo:function(){var e=this;wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(n){e.addUserInfo(n.data[0])},fail:function(e){console.error(e)}})},addUserInfo:function(e){this.userRankInfo.children.length<=0&&(cc.instantiate(this.prefab).parent=this.userRankInfo);var n=this.userRankInfo.children[0];n.x=0,n.getChildByName("userName").getComponent(cc.Label).string=e.nickName||e.nickname,cc.loader.load({url:e.avatarUrl,type:"png"},function(e,t){e&&console.error(e),n.getChildByName("mask").children[0].getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)})},initUserScoreInfo:function(){var e=this;this.initUserInfo(),wx.getUserCloudStorage({keyList:["score"],success:function(n){e.addScore(n.KVDataList[0].value)}})},addScore:function(e){this.userRankInfo.children.length<=0&&(cc.instantiate(this.prefab).parent=this.userRankInfo);this.userRankInfo.children[0].getChildByName("score").getComponent(cc.Label).string=e||0},initFriendRankInfo:function(){var e=this;wx.getFriendCloudStorage({keyList:["score"],success:function(n){for(var t=e.rankUserScore(n),r=0;r<t.length;++r)e.createUserBlock(t[r])}})},createUserBlock:function(e){var n=cc.instantiate(this.prefab);n.parent=this.content,n.x=0,n.getChildByName("userName").getComponent(cc.Label).string=e.nickName||e.nickname,cc.loader.load({url:e.avatarUrl,type:"png"},function(e,t){e&&console.error(e),n.getChildByName("mask").children[0].getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)}),n.getChildByName("score").getComponent(cc.Label).string=e.KVDataList[0].value||0},rankUserScore:function(e){for(var n=[],t=0;t<e.data.length;++t)n.push(e.data[t]);return n.sort(this.rank),n},rank:function(e,n){return n.KVDataList[0].value-e.KVDataList[0].value}}),cc._RF.pop()},{}]},{},["launch"]);