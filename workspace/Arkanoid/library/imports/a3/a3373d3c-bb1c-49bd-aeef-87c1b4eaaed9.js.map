{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\controller/assets\\scripts\\controller\\GameCtl.js"],"names":["GameModel","require","Ball","Slump","cc","Class","extends","Component","properties","gameView","paddle","brickLayout","overPanel","ballPrefab","Prefab","slumpPrefab","scoreAudio","default","type","AudioClip","collisionAudio","startBackGround","Node","wxSubContextView","wxBackGround","rankButton","addLifeButton","allSkillBall","allBall","allSlump","videoAd","onLoad","physicsManager","director","getPhysicsManager","gameModel","updateGameModel","startGame","active","authorize","update","init","reBeginGame","enabled","initScore","initLevel","initLife","initLevelPosition","life","level","bricksNumber","getLevelPosition","getLevelSilveryPosition","reInit","createNewBall","updatePaddleShort","updatePaddleLong","updateBrick","reInitLevelPosition","reStartGame","levelPosition","destroyAllBall","pauseGame","resumeGame","stopGame","unscheduleAllCallbacks","show","score","surviveBricksNumber","setUserScorePassage","showReBegin","onBallContactBrick","ballNode","brickNode","parent","audioEngine","playEffect","destroy","addScore","minusSurviveBrick","updateScore","addLevel","destroyBall","updateLevel","dropBricks","i","length","pos","createSlump","position","onBallContactGround","groundNode","ballCount","reduceLife","updateLife","onBallContactPaddle","paddleNode","onBallContactWall","instantiate","node","isSkill","_color","color","getComponent","addBallCount","createSkillBallFactory","schedule","createSkillBall","ballNode1","collider1","PhysicsCircleCollider","radius","apply","Ball1","width","ballNode2","collider","initSkillBall","destroySkillBall","slumpNode","destroySlump","reduceBallCount","j","skillBallNode","ballParentChildren","_children","_name","PhysicsPolygonCollider","points","x","paddleShortSchedule","scheduleOnce","paddleLongSchedule","updateBrickSensorTrue","ballParentNode","ballNodes","children","name","brickSchedule","updateBrickSensorFalse","onBtnRank","initUserInfo","nickName","avatarUrl","a","wx","getOpenDataContext","postMessage","message","oldScore","getStorageSync","setStorageSync","setUserCloudStorage","KVDataList","key","value","success","console","log","res","openDataContext","fail","e","onBtnBack","banner","isShow","winSize","getSystemInfoSync","bannerHeight","bannerWidth","bannerAd","createBannerAd","adUnitId","style","left","windowWidth","top","windowHeight","onError","err","initVideoAd","createRewardedVideoAd","catch","load","then","tag","onClose","isEnded","undefined","addLife","socket","response","xhr","XMLHttpRequest","onreadystatechange","readyState","status","result","responseText","rankMap","JSON","parse","open","send","playerLogin","getUserInfo","openIdList","lang","socketInfo","data","error","user","rankCondition","Object","start","count","json","stringify","exportJson","sysInfo","window","screenWidth","height","screenHeight","getSetting","authSetting","userInfo","button","createUserInfoButton","text","backgroundColor","fontSize","textAlign","lineHeight","onTap"],"mappings":"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","file":"GameCtl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["/*\r\n * @Author: ayue \r\n * @Date: 2019-03-30 20:18:41 \r\n * @Last Modified by: ayue\r\n * @Last Modified time: 2019-09-18 11:33:32\r\n */\r\n\r\nconst GameModel = require('GameModel');\r\nvar Ball = require(\"Ball\");\r\nconst Slump = require('Slump');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameView: require('GameView'),\r\n        paddle: require('Paddle'),\r\n        brickLayout: require('BrickLayout'),\r\n        overPanel: require('OverPanel'),\r\n        ballPrefab: cc.Prefab,\r\n        slumpPrefab: cc.Prefab,\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        // 跳跃音效资源\r\n        collisionAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        startBackGround: cc.Node,\r\n        wxSubContextView: cc.Node,\r\n        wxBackGround: cc.Node,\r\n        rankButton: cc.Node,\r\n        addLifeButton: cc.Node,\r\n        allSkillBall: [],\r\n        allBall: [],\r\n        allSlump: [],\r\n        videoAd: null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        this.gameModel = new GameModel();\r\n        this.overPanel.updateGameModel(this.gameModel);\r\n        this.startGame();\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n        this.authorize();\r\n        this.addLifeButton.active = false;\r\n    },\r\n    update: function () {\r\n\r\n    },\r\n\r\n    startGame() {\r\n        this.init();\r\n        this.reBeginGame();\r\n    },\r\n    //部分属性初始化（游戏初始化时调用）\r\n    init() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameModel.init();\r\n        this.gameModel.initScore();\r\n        this.gameModel.initLevel();\r\n        this.gameModel.initLife();\r\n        this.gameModel.initLevelPosition();\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initScore();\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.paddle.init();\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n        this.overPanel.init(this);\r\n\r\n    },\r\n    //部分属性重新初始化（在玩家仍然有机会时初始化调用）\r\n    reInit() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameView.init(this);\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.createNewBall();\r\n        this.paddle.init();\r\n        this.overPanel.init(this);\r\n        this.updatePaddleShort(true);\r\n        this.updatePaddleLong(false);\r\n        this.updateBrick(false);\r\n    },\r\n    //重新绘制关卡\r\n    reInitLevelPosition() {\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n    },\r\n    //重新开始游戏，用于还有机会的情况下\r\n    reStartGame(levelPosition) {\r\n        this.destroyAllBall();\r\n        this.reInit(levelPosition);\r\n        this.startBackGround.active = false;\r\n    },\r\n    pauseGame() {\r\n        this.physicsManager.enabled = false;\r\n    },\r\n\r\n    resumeGame() {\r\n        this.physicsManager.enabled = true;\r\n    },\r\n    //结束游戏\r\n    stopGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.show(this.gameModel.score, this.gameModel.surviveBricksNumber === 0, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //重新开始游戏（在玩家还有机会时调用）\r\n    reBeginGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.showReBegin(this.gameModel.score, this.gameModel.life, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //小球撞击砖块处理\r\n    onBallContactBrick(ballNode, brickNode) {\r\n        //处理因为并发问题引起的砖块未打干净而结束计数的bug\r\n        if (brickNode.parent == null) {\r\n            return;\r\n        }\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        if (brickNode.life > 1) {\r\n            brickNode.life = brickNode.life - 1;\r\n        } else {\r\n            brickNode.parent = null;\r\n            brickNode.destroy();\r\n            this.gameModel.addScore(1);\r\n            // this.gameModel.minusBrick(1);\r\n            this.gameModel.minusSurviveBrick(1);\r\n            this.gameView.updateScore(this.gameModel.score);\r\n            //本关结束\r\n            if (this.gameModel.surviveBricksNumber <= 0) {\r\n                this.gameModel.addLevel();\r\n                this.overPanel.updateGameModel(this.gameModel);\r\n                this.destroyBall(ballNode);\r\n                this.reBeginGame();\r\n                this.destroyAllBall();\r\n                this.gameView.updateLevel(this.gameModel.level);\r\n            }\r\n            var dropBricks = this.gameModel.dropBricks;\r\n            for (var i = 0; i < dropBricks.length; i++) {\r\n                if (brickNode.pos == dropBricks[i]) {\r\n                    this.createSlump(brickNode.position, i);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //小球撞击地板处理\r\n    onBallContactGround(ballNode, groundNode) {\r\n        if (this.gameModel.ballCount <= 1) {\r\n            if (this.gameModel.life > 1 && this.gameModel.surviveBricksNumber > 0) {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n            } else {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.stopGame();\r\n                this.addLifeButton.active = true;\r\n            }\r\n            this.destroyBall(ballNode);\r\n        } else {\r\n            this.destroyBall(ballNode);\r\n        }\r\n    },\r\n    //小球撞击托盘播放音效\r\n    onBallContactPaddle(ballNode, paddleNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //小球撞击墙壁播放音效\r\n    onBallContactWall(ballNode, brickNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //创建新的小球\r\n    createNewBall() {\r\n        //小球复制代码\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        ballNode.parent = this.paddle.node.parent;\r\n        ballNode.isSkill = 0;\r\n        if (this.allBall.length > 0) {\r\n            if (this.allBall[0] != null) {\r\n                if (this.allBall[0]._color != null) {\r\n                    ballNode.color = this.allBall[0].color;\r\n                }\r\n            }\r\n        }\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.init(this, this.paddle.node.position);\r\n        this.gameModel.addBallCount();\r\n    },\r\n    //创建技能小球计时器\r\n    createSkillBallFactory() {\r\n        this.schedule(this.createSkillBall, 0.3, 20, 0.1);\r\n    },\r\n    //创建技能小球\r\n    createSkillBall() {\r\n        //小球复制代码\r\n        let ballNode1 = cc.instantiate(this.ballPrefab);\r\n        let collider1 = ballNode1.getComponent(cc.PhysicsCircleCollider);\r\n        collider1.radius = 6;\r\n        collider1.apply()\r\n        ballNode1.isSkill = 1;\r\n        ballNode1.parent = this.paddle.node.parent;\r\n        ballNode1.color = cc.color(209, 10, 247);\r\n        var Ball1 = ballNode1.getComponent('Ball')\r\n        Ball1.node.width = 10;\r\n\r\n        let ballNode2 = cc.instantiate(this.ballPrefab);\r\n        let collider = ballNode2.getComponent(cc.PhysicsCircleCollider);\r\n        collider.radius = 6;\r\n        collider.apply()\r\n        ballNode2.isSkill = 1;\r\n        ballNode2.parent = this.paddle.node.parent;\r\n        ballNode2.color = cc.color(209, 10, 247);\r\n        var Ball = ballNode2.getComponent('Ball')\r\n        Ball.node.width = 10;\r\n\r\n        Ball1.initSkillBall(this, this.paddle.node.position, \"left\");\r\n        Ball.initSkillBall(this, this.paddle.node.position, \"right\");\r\n\r\n    },\r\n    //处理技能小球\r\n    destroySkillBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n    },\r\n    //创建掉落砖块\r\n    createSlump(position, i) {\r\n        var slumpNode = cc.instantiate(this.slumpPrefab);\r\n        slumpNode.parent = this.brickLayout.node;\r\n        var Slump = slumpNode.getComponent('Slump')\r\n        if (i % 5 == 1) {\r\n            slumpNode.color = cc.color(255, 0, 0);//红\r\n            slumpNode.type = 1;\r\n        } else if (i % 5 == 2) {\r\n            slumpNode.color = cc.color(0, 255, 255);//绿\r\n            slumpNode.type = 2;\r\n        } else if (i % 5 == 3) {\r\n            slumpNode.color = cc.color(209, 10, 247);//紫\r\n            slumpNode.type = 3;\r\n        } else if (i % 5 == 4) {\r\n            slumpNode.color = cc.color(231, 129, 0);//橙\r\n            slumpNode.type = 4;\r\n        } else {\r\n            slumpNode.type = 0;//黄\r\n        }\r\n        Slump.init(this, position);\r\n    },\r\n    //销毁掉落砖块\r\n    destroySlump(slumpNode) {\r\n        slumpNode.destroy();\r\n    },\r\n\r\n    //销毁单个小球（小球撞击地板时调用）\r\n    destroyBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n        this.gameModel.reduceBallCount();\r\n    },\r\n    //销毁全部小球和掉落物（游戏结束时调用(包括有机会时)）\r\n    destroyAllBall() {\r\n        if (this.allSkillBall.length > 0) {\r\n            for (let j = 0; j < this.allSkillBall.length; j++) {\r\n                let skillBallNode = this.allSkillBall[j];\r\n                this.destroySkillBall(skillBallNode);\r\n            }\r\n            this.allSkillBall = [];\r\n        }\r\n\r\n        var ballParentChildren = this.paddle.node.parent._children;\r\n        for (var i = 0; i < ballParentChildren.length; i++) {\r\n            var node = ballParentChildren[i];\r\n            if (node._name == \"ball\") {\r\n                if (node.isSkill == 0) {\r\n                    this.destroyBall(node);\r\n                }\r\n            }\r\n        }\r\n        this.allBall = [];\r\n\r\n        if (this.allSlump.length > 0) {\r\n            for (let j = 0; j < this.allSlump.length; j++) {\r\n                let slumpNode = this.allSlump[j];\r\n                this.destroySlump(slumpNode);\r\n            }\r\n            this.allSlump = [];\r\n        }\r\n    },\r\n    //更换托盘\r\n    updatePaddleShort(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n                this.paddleShortSchedule();\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleShortSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleShort(true);\r\n        }, 10);\r\n    },\r\n\r\n    //更换托盘\r\n    updatePaddleLong(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n                this.paddleLongSchedule();\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleLongSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleLong(false);\r\n        }, 10);\r\n    },\r\n    //更新砖块为有碰撞回调，有无碰撞效果\r\n    updateBrick(active) {\r\n        if (active == true) {\r\n            this.brickLayout.updateBrickSensorTrue();\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 0);\r\n                    }\r\n                }\r\n            }\r\n            this.brickSchedule();\r\n        } else {\r\n            this.brickLayout.updateBrickSensorFalse()\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 255);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    //砖块碰撞效果恢复计时器\r\n    brickSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updateBrick(false);\r\n        }, 10);\r\n    },\r\n\r\n    //排行榜按钮\r\n    onBtnRank() {\r\n        this.initUserInfo()\r\n    },\r\n    //初始化玩家排行榜\r\n    initUserInfo(nickName, avatarUrl) {\r\n        //权限按钮\r\n        // if(this.nickName.string == \"nickName\"){\r\n        //     let systemInfo = wx.getSystemInfoSync();\r\n        //     let width = systemInfo.windowWidth;\r\n        //     let height = systemInfo.windowHeight;\r\n        // const button = wx.createUserInfoButton({\r\n        //     type: 'text',\r\n        //     text: '',\r\n        //     style: {\r\n        //         left: 0,\r\n        //         top: 0,\r\n        //         width: width,\r\n        //         height: height,\r\n        //         lineHeight: 40,\r\n        //         backgroundColor: '#00000000',\r\n        //         color: '#00000000',\r\n        //         textAlign: 'center',\r\n        //         fontSize: 10,\r\n        //         borderRadius: 4\r\n        //     }\r\n        // })\r\n        //\r\n        // button.onTap((res) => {\r\n        //     let userInfo = res.userInfo;\r\n        //     this.nickName.string = userInfo.nickName;\r\n        //     cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\r\n        //         if (err) {\r\n        //             console.error(err);\r\n        //             return;\r\n        //         }\r\n        //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\r\n        //     });\r\n        //     button.hide();\r\n        //     button.destroy();\r\n        //\r\n        // })\r\n        // }\r\n        this.wxSubContextView.active = true;\r\n        this.wxBackGround.active = true;\r\n        let a = wx.getOpenDataContext().postMessage({\r\n            message: \"User info get success.\"\r\n        });\r\n    },\r\n    //上传玩家得分\r\n    setUserScorePassage(score) {\r\n        try {\r\n            const oldScore = wx.getStorageSync('maxScore') || 0;\r\n            if (oldScore < score) {\r\n                try {\r\n                    wx.setStorageSync('maxScore', score);\r\n                    wx.setUserCloudStorage({\r\n                        KVDataList: [{ key: \"score\", value: score + \"\" }],\r\n                        success: res => {\r\n                            console.log(res);\r\n                            // 让子域更新当前用户的最高分，因为主域无法得到getUserCloadStorage;\r\n                            let openDataContext = wx.getOpenDataContext();\r\n                            openDataContext.postMessage({\r\n                                type: 'updateMaxScore',\r\n                            });\r\n                        },\r\n                        fail: res => {\r\n                            console.log(res);\r\n                        }\r\n                    });\r\n                } catch (e) {\r\n                    console.log(\"数据存储失败\")\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.log(\"获取数据存储失败\")\r\n        }\r\n    },\r\n\r\n    //排行榜返回按钮\r\n    onBtnBack() {\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n    banner(isShow) {\r\n        if (isShow == true) {\r\n            let winSize = wx.getSystemInfoSync();\r\n            let bannerHeight = 135;\r\n            let bannerWidth = 360;\r\n            // 创建 Banner 广告实例，提前初始化\r\n            if (this.bannerAd == null) {\r\n                this.bannerAd = wx.createBannerAd({\r\n                    adUnitId: 'adunit-256c6c4d51b28192',\r\n                    style: {\r\n                        left: (winSize.windowWidth - bannerWidth) / 2 + 0.1,\r\n                        top: winSize.windowHeight - bannerHeight - 30,\r\n                        width: bannerWidth,\r\n                    }\r\n                })\r\n                // 在适合的场景显示 Banner 广告\r\n                this.bannerAd.show();\r\n                this.bannerAd.onError(err => {\r\n                    console.log(\"广告拉取错误\");\r\n                    console.log(err);\r\n                })\r\n            } else {\r\n                this.bannerAd.destroy();\r\n                this.bannerAd = null;\r\n            }\r\n        } else {\r\n            if (this.bannerAd != null) {\r\n                this.bannerAd.destroy();\r\n                this.bannerAd = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    initVideoAd() {\r\n        //实例\r\n        // 创建激励视频广告实例，提前初始化\r\n        let videoAd = wx.createRewardedVideoAd({\r\n            adUnitId: 'adunit-97d79c620e54fee7'\r\n        })\r\n\r\n        this.videoAd = videoAd;\r\n        // 用户触发广告后，显示激励视频广告\r\n        this.videoAd.show().catch(() => {\r\n            // 失败重试\r\n            this.videoAd.load()\r\n                .then(() => this.videoAd.show())\r\n                .catch(err => {\r\n                    console.log('激励视频 广告显示失败')\r\n                })\r\n        })\r\n        //捕捉错误\r\n        this.videoAd.onError(err => {\r\n            console.log(err)\r\n        })\r\n        let tag = 1;\r\n        //关闭视频的回调函数\r\n        this.videoAd.onClose(res => {\r\n            // 用户点击了【关闭广告】按钮\r\n            // 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n            if (tag <= 1) {\r\n                if (res && res.isEnded || res === undefined) {\r\n                    this.gameModel.addLife();\r\n                    this.gameView.updateLife(this.gameModel.life)\r\n                    this.overPanel.updateGameModel(this.gameModel)\r\n                    this.reBeginGame();\r\n                    this.banner(true);\r\n                    this.addLifeButton.active = false;\r\n                } else {\r\n                    // 播放中途退出，不下发游戏奖励\r\n                    this.banner(true);\r\n                }\r\n                tag++;\r\n            }\r\n        })\r\n\r\n    },\r\n\r\n\r\n    socket(response) {\r\n        console.log(response + \"1111111111111111111111111\");\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var result = xhr.responseText;\r\n                let rankMap = JSON.parse(result)\r\n                console.log(rankMap);\r\n                // la.test1(rankMap);\r\n            }\r\n        }\r\n        xhr.open('POST', 'http://47.105.63.173:17594', true);\r\n        // var rankCondition = new Object();\r\n        // rankCondition.start = 0;\r\n        // rankCondition.count = 100;\r\n        // let json = JSON.stringify(rankCondition);\r\n        // let response1 = \"AYUE\"+\"1001-\" + json;\r\n        xhr.send(response);\r\n    },\r\n\r\n    playerLogin() {\r\n        wx.getUserInfo({\r\n            openIdList: ['selfOpenId'],\r\n            lang: 'zh_CN',\r\n            success: (res) => {\r\n                socketInfo(res.data[0]);\r\n            },\r\n\r\n            fail: (res) => {\r\n                console.error(res);\r\n            }\r\n        });\r\n\r\n        function socketInfo(user) {\r\n            console.log(user + \"66666666666666666666666\");\r\n            // console.log(playerInfo);\r\n            // playerInfo.nickName = user.nickName || user.nickname;\r\n            // playerInfo.avatarUrl = user.avatarUrl;\r\n            var rankCondition = new Object();\r\n            rankCondition.start = 0;\r\n            rankCondition.count = 100;\r\n            let json = JSON.stringify(rankCondition);\r\n            let response = \"AYUE\" + \"1001-\" + json;\r\n            console.log(response)\r\n            this.socket(response)\r\n        }\r\n    },\r\n\r\n\r\n    authorize() {\r\n        let exportJson = {};\r\n        let sysInfo = window.wx.getSystemInfoSync();\r\n        //获取微信界面大小\r\n        let width = sysInfo.screenWidth;\r\n        let height = sysInfo.screenHeight;\r\n        window.wx.getSetting({\r\n            success(res) {\r\n                console.log(res.authSetting);\r\n                if (res.authSetting[\"scope.userInfo\"]) {\r\n                    console.log(\"用户已授权\");\r\n                    window.wx.getUserInfo({\r\n                        success(res) {\r\n                            console.log(res);\r\n                            exportJson.userInfo = res.userInfo;\r\n                            //此时可进行登录操作\r\n                        }\r\n                    });\r\n                } else {\r\n                    console.log(\"用户未授权\");\r\n                    let button = window.wx.createUserInfoButton({\r\n                        type: 'text',\r\n                        text: '',\r\n                        style: {\r\n                            left: 130,\r\n                            top: 470,\r\n                            width: 150,\r\n                            height: 50,\r\n                            backgroundColor: '#00000000',//最后两位为透明度\r\n                            color: '#ffffff',\r\n                            fontSize: 20,\r\n                            textAlign: \"center\",\r\n                            lineHeight: height,\r\n                        }\r\n                    });\r\n                    button.onTap((res) => {\r\n                        if (res.userInfo) {\r\n                            console.log(\"用户授权:\", res);\r\n                            exportJson.userInfo = res.userInfo;\r\n                            //此时可进行登录操作\r\n                            button.destroy();\r\n                        } else {\r\n                            console.log(\"用户拒绝授权:\", res);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        })\r\n\r\n    },\r\n\r\n});"]}