{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\controller/assets\\scripts\\controller\\GameCtl.js"],"names":["GameModel","require","Ball","Slump","cc","Class","extends","Component","properties","gameView","paddle","brickLayout","overPanel","ballPrefab","Prefab","slumpPrefab","scoreAudio","default","type","AudioClip","collisionAudio","startBackGround","Node","wxSubContextView","wxBackGround","allSkillBall","allBall","allSlump","onLoad","physicsManager","director","getPhysicsManager","gameModel","updateGameModel","startGame","active","update","init","reBeginGame","enabled","initScore","initLevel","initLife","initLevelPosition","life","level","bricksNumber","getLevelPosition","getLevelSilveryPosition","reInit","createNewBall","updatePaddleShort","updatePaddleLong","updateBrick","reInitLevelPosition","reStartGame","levelPosition","destroyAllBall","pauseGame","resumeGame","stopGame","unscheduleAllCallbacks","show","score","surviveBricksNumber","setUserScorePassage","showReBegin","onBallContactBrick","ballNode","brickNode","parent","audioEngine","playEffect","destroy","addScore","minusSurviveBrick","updateScore","addLevel","destroyBall","updateLevel","dropBricks","i","length","pos","createSlump","position","onBallContactGround","groundNode","ballCount","reduceLife","updateLife","onBallContactPaddle","paddleNode","onBallContactWall","instantiate","node","isSkill","_color","color","getComponent","addBallCount","createSkillBallFactory","schedule","createSkillBall","ballNode1","collider1","PhysicsCircleCollider","radius","apply","Ball1","width","collider","initSkillBall","destroySkillBall","slumpNode","destroySlump","reduceBallCount","j","skillBallNode","ballParentChildren","_children","_name","PhysicsPolygonCollider","points","x","paddleShortSchedule","scheduleOnce","paddleLongSchedule","updateBrickSensorTrue","ballParentNode","ballNodes","children","name","brickSchedule","updateBrickSensorFalse","onBtnRank","initUserInfo","nickName","avatarUrl","a","wx","getOpenDataContext","postMessage","message","oldScore","getStorageSync","setStorageSync","setUserCloudStorage","KVDataList","key","value","success","console","log","res","openDataContext","fail","e","onBtnBack"],"mappings":"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","file":"GameCtl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["/*\r\n * @Author: ayue \r\n * @Date: 2019-03-30 20:18:41 \r\n * @Last Modified by: ayue\r\n * @Last Modified time: 2019-05-20 16:03:59\r\n */\r\n\r\nconst GameModel = require('GameModel');\r\nvar Ball = require(\"Ball\");\r\nconst Slump = require('Slump');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameView: require('GameView'),\r\n        paddle: require('Paddle'),\r\n        brickLayout: require('BrickLayout'),\r\n        overPanel: require('OverPanel'),\r\n        ballPrefab: cc.Prefab,\r\n        slumpPrefab: cc.Prefab,\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        // 跳跃音效资源\r\n        collisionAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        startBackGround: cc.Node,\r\n        wxSubContextView: cc.Node,\r\n        wxBackGround: cc.Node,\r\n        allSkillBall: [],\r\n        allBall: [],\r\n        allSlump: [],\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        this.gameModel = new GameModel();\r\n        this.overPanel.updateGameModel(this.gameModel);\r\n        this.startGame();\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n\r\n    },\r\n    update: function () {\r\n\r\n    },\r\n\r\n\r\n    startGame() {\r\n        this.init();\r\n        this.reBeginGame();\r\n    },\r\n    //部分属性初始化（游戏初始化时调用）\r\n    init() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameModel.init();\r\n        this.gameModel.initScore();\r\n        this.gameModel.initLevel();\r\n        this.gameModel.initLife();\r\n        this.gameModel.initLevelPosition();\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initScore();\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.paddle.init();\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n        this.overPanel.init(this);\r\n    },\r\n    //部分属性重新初始化（在玩家仍然有机会时初始化调用）\r\n    reInit() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameView.init(this);\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.createNewBall();\r\n        this.paddle.init();\r\n        this.overPanel.init(this);\r\n        this.updatePaddleShort(true);\r\n        this.updatePaddleLong(false);\r\n        this.updateBrick(false);\r\n    },\r\n    //重新绘制关卡\r\n    reInitLevelPosition() {\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n    },\r\n    //重新开始游戏，用于还有机会的情况下\r\n    reStartGame(levelPosition) {\r\n        this.destroyAllBall();\r\n        this.reInit(levelPosition);\r\n        this.startBackGround.active = false;\r\n    },\r\n    pauseGame() {\r\n        this.physicsManager.enabled = false;\r\n    },\r\n\r\n    resumeGame() {\r\n        this.physicsManager.enabled = true;\r\n    },\r\n    //结束游戏\r\n    stopGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.show(this.gameModel.score, this.gameModel.surviveBricksNumber === 0, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //重新开始游戏（在玩家还有机会时调用）\r\n    reBeginGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.showReBegin(this.gameModel.score, this.gameModel.life, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //小球撞击砖块处理\r\n    onBallContactBrick(ballNode, brickNode) {\r\n        //处理因为并发问题引起的砖块未打干净而结束计数的bug\r\n        if (brickNode.parent == null) {\r\n            return;\r\n        }\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        if (brickNode.life > 1) {\r\n            brickNode.life = brickNode.life - 1;\r\n        } else {\r\n            brickNode.parent = null;\r\n            brickNode.destroy();\r\n            this.gameModel.addScore(1);\r\n            // this.gameModel.minusBrick(1);\r\n            this.gameModel.minusSurviveBrick(1);\r\n            this.gameView.updateScore(this.gameModel.score);\r\n            //本关结束\r\n            if (this.gameModel.surviveBricksNumber <= 0) {\r\n                this.gameModel.addLevel();\r\n                this.overPanel.updateGameModel(this.gameModel);\r\n                this.destroyBall(ballNode);\r\n                this.reBeginGame();\r\n                this.destroyAllBall();\r\n                this.gameView.updateLevel(this.gameModel.level);\r\n            }\r\n            var dropBricks = this.gameModel.dropBricks;\r\n            for (var i = 0; i < dropBricks.length; i++) {\r\n                if (brickNode.pos == dropBricks[i]) {\r\n                    this.createSlump(brickNode.position, i);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //小球撞击地板处理\r\n    onBallContactGround(ballNode, groundNode) {\r\n        if (this.gameModel.ballCount <= 1) {\r\n            if (this.gameModel.life > 1 && this.gameModel.surviveBricksNumber > 0) {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n            } else {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.stopGame();\r\n            }\r\n            this.destroyBall(ballNode);\r\n        } else {\r\n            this.destroyBall(ballNode);\r\n        }\r\n    },\r\n    //小球撞击托盘播放音效\r\n    onBallContactPaddle(ballNode, paddleNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //小球撞击墙壁播放音效\r\n    onBallContactWall(ballNode, brickNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //创建新的小球\r\n    createNewBall() {\r\n        //小球复制代码\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        ballNode.parent = this.paddle.node.parent;\r\n        ballNode.isSkill = 0;\r\n        if (this.allBall.length > 0) {\r\n            if (this.allBall[0] != null) {\r\n                if (this.allBall[0]._color != null) {\r\n                    ballNode.color = this.allBall[0].color;\r\n                }\r\n            }\r\n        }\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.init(this, this.paddle.node.position);\r\n        this.gameModel.addBallCount();\r\n    },\r\n    //创建技能小球计时器\r\n    createSkillBallFactory() {\r\n        this.schedule(this.createSkillBall, 0.3, 20, 0.1);\r\n    },\r\n    //创建技能小球\r\n    createSkillBall() {\r\n        //小球复制代码\r\n        var ballNode1 = cc.instantiate(this.ballPrefab);\r\n        let collider1 = ballNode1.getComponent(cc.PhysicsCircleCollider);\r\n        collider1.radius = 6;\r\n        collider1.apply()\r\n        ballNode1.isSkill = 1;\r\n        ballNode1.parent = this.paddle.node.parent;\r\n        ballNode1.color = cc.color(209, 10, 247);\r\n        var Ball1 = ballNode1.getComponent('Ball')\r\n        Ball1.node.width=12;\r\n\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        let collider = ballNode.getComponent(cc.PhysicsCircleCollider);\r\n        collider.radius = 6;\r\n        collider.apply()\r\n        ballNode.isSkill = 1;\r\n        ballNode.parent = this.paddle.node.parent;\r\n        ballNode.color = cc.color(209, 10, 247);\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.node.width =12;\r\n\r\n        Ball1.initSkillBall(this, this.paddle.node.position, \"left\");\r\n        Ball.initSkillBall(this, this.paddle.node.position, \"right\");\r\n        \r\n    },\r\n    //处理技能小球\r\n    destroySkillBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n    },\r\n    //创建掉落砖块\r\n    createSlump(position, i) {\r\n        var slumpNode = cc.instantiate(this.slumpPrefab);\r\n        slumpNode.parent = this.brickLayout.node;\r\n        var Slump = slumpNode.getComponent('Slump')\r\n        if (i % 5 == 1) {\r\n            slumpNode.color = cc.color(255, 0, 0);//红\r\n            slumpNode.type = 1;\r\n        } else if (i % 5 == 2) {\r\n            slumpNode.color = cc.color(0, 255, 255);//绿\r\n            slumpNode.type = 2;\r\n        } else if (i % 5 == 3) {\r\n            slumpNode.color = cc.color(209, 10, 247);//紫\r\n            slumpNode.type = 3;\r\n        } else if (i % 5 == 4) {\r\n            slumpNode.color = cc.color(231, 129, 0);//橙\r\n            slumpNode.type = 4;\r\n        } else {\r\n            slumpNode.type = 0;//黄\r\n        }\r\n        Slump.init(this, position);\r\n    },\r\n    //销毁掉落砖块\r\n    destroySlump(slumpNode) {\r\n        slumpNode.destroy();\r\n    },\r\n\r\n    //销毁单个小球（小球撞击地板时调用）\r\n    destroyBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n        this.gameModel.reduceBallCount();\r\n    },\r\n    //销毁全部小球和掉落物（游戏结束时调用(包括有机会时)）\r\n    destroyAllBall() {\r\n        if (this.allSkillBall.length > 0) {\r\n            for (let j = 0; j < this.allSkillBall.length; j++) {\r\n                let skillBallNode = this.allSkillBall[j];\r\n                this.destroySkillBall(skillBallNode);\r\n            }\r\n            this.allSkillBall = [];\r\n        }\r\n\r\n        var ballParentChildren = this.paddle.node.parent._children;\r\n        for (var i = 0; i < ballParentChildren.length; i++) {\r\n            var node = ballParentChildren[i];\r\n            if (node._name == \"ball\") {\r\n                if (node.isSkill == 0) {\r\n                    this.destroyBall(node);\r\n                }\r\n            }\r\n        }\r\n        this.allBall = [];\r\n\r\n        if (this.allSlump.length > 0) {\r\n            for (let j = 0; j < this.allSlump.length; j++) {\r\n                let slumpNode = this.allSlump[j];\r\n                this.destroySlump(slumpNode);\r\n            }\r\n            this.allSlump = [];\r\n        }\r\n    },\r\n    //更换托盘\r\n    updatePaddleShort(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n                this.paddleShortSchedule();\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleShortSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleShort(true);\r\n        }, 10);\r\n    },\r\n\r\n    //更换托盘\r\n    updatePaddleLong(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n                this.paddleLongSchedule();\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleLongSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleLong(false);\r\n        }, 10);\r\n    },\r\n    //更新砖块为有碰撞回调，有无碰撞效果\r\n    updateBrick(active) {\r\n        if (active == true) {\r\n            this.brickLayout.updateBrickSensorTrue();\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 0);\r\n                    }\r\n                }\r\n            }\r\n            this.brickSchedule();\r\n        } else {\r\n            this.brickLayout.updateBrickSensorFalse()\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 255);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    //砖块碰撞效果恢复计时器\r\n    brickSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updateBrick(false);\r\n        }, 10);\r\n    },\r\n\r\n\r\n    //排行榜按钮\r\n    onBtnRank() {\r\n        this.initUserInfo()\r\n    },\r\n    //初始化玩家排行榜\r\n    initUserInfo(nickName, avatarUrl) {\r\n        //权限按钮\r\n        // if(this.nickName.string == \"nickName\"){\r\n        //     let systemInfo = wx.getSystemInfoSync();\r\n        //     let width = systemInfo.windowWidth;\r\n        //     let height = systemInfo.windowHeight;\r\n        // const button = wx.createUserInfoButton({\r\n        //     type: 'text',\r\n        //     text: '',\r\n        //     style: {\r\n        //         left: 0,\r\n        //         top: 0,\r\n        //         width: width,\r\n        //         height: height,\r\n        //         lineHeight: 40,\r\n        //         backgroundColor: '#00000000',\r\n        //         color: '#00000000',\r\n        //         textAlign: 'center',\r\n        //         fontSize: 10,\r\n        //         borderRadius: 4\r\n        //     }\r\n        // })\r\n        //\r\n        // button.onTap((res) => {\r\n        //     let userInfo = res.userInfo;\r\n        //     this.nickName.string = userInfo.nickName;\r\n        //     cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\r\n        //         if (err) {\r\n        //             console.error(err);\r\n        //             return;\r\n        //         }\r\n        //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\r\n        //     });\r\n        //     button.hide();\r\n        //     button.destroy();\r\n        //\r\n        // })\r\n        // }\r\n\r\n        this.wxSubContextView.active = true;\r\n        this.wxBackGround.active = true;\r\n        let a = wx.getOpenDataContext().postMessage({\r\n            message: \"User info get success.\"\r\n        });\r\n    },\r\n    //上传玩家得分\r\n    setUserScorePassage(score) {\r\n        try {\r\n            const oldScore = wx.getStorageSync('maxScore') || 0;\r\n            if (oldScore < score) {\r\n                try {\r\n                    wx.setStorageSync('maxScore', score);\r\n                    wx.setUserCloudStorage({\r\n                        KVDataList: [{ key: \"score\", value: score + \"\" }],\r\n                        success: res => {\r\n                            console.log(res);\r\n                            // 让子域更新当前用户的最高分，因为主域无法得到getUserCloadStorage;\r\n                            let openDataContext = wx.getOpenDataContext();\r\n                            openDataContext.postMessage({\r\n                                type: 'updateMaxScore',\r\n                            });\r\n                        },\r\n                        fail: res => {\r\n                            console.log(res);\r\n                        }\r\n                    });\r\n                } catch (e) {\r\n                    console.log(\"数据存储失败\")\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.log(\"获取数据存储失败\")\r\n        }\r\n    },\r\n\r\n    //排行榜返回按钮\r\n    onBtnBack() {\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n\r\n\r\n});"]}