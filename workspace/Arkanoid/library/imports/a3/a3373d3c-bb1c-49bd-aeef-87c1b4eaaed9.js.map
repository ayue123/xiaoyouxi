{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\controller/assets\\scripts\\controller\\GameCtl.js"],"names":["GameModel","require","Ball","Slump","cc","Class","extends","Component","properties","gameView","paddle","brickLayout","overPanel","ballPrefab","Prefab","slumpPrefab","scoreAudio","default","type","AudioClip","collisionAudio","startBackGround","Node","wxSubContextView","wxBackGround","allSkillBall","allBall","allSlump","videoAd","onLoad","physicsManager","director","getPhysicsManager","gameModel","updateGameModel","startGame","active","update","init","reBeginGame","enabled","initScore","initLevel","initLife","initLevelPosition","life","level","bricksNumber","getLevelPosition","getLevelSilveryPosition","reInit","createNewBall","updatePaddleShort","updatePaddleLong","updateBrick","reInitLevelPosition","reStartGame","levelPosition","destroyAllBall","pauseGame","resumeGame","stopGame","unscheduleAllCallbacks","show","score","surviveBricksNumber","setUserScorePassage","showReBegin","onBallContactBrick","ballNode","brickNode","parent","audioEngine","playEffect","destroy","addScore","minusSurviveBrick","updateScore","addLevel","destroyBall","updateLevel","dropBricks","i","length","pos","createSlump","position","onBallContactGround","groundNode","ballCount","reduceLife","updateLife","onBallContactPaddle","paddleNode","onBallContactWall","instantiate","node","isSkill","_color","color","getComponent","addBallCount","createSkillBallFactory","schedule","createSkillBall","ballNode1","collider1","PhysicsCircleCollider","radius","apply","Ball1","width","ballNode2","collider","initSkillBall","destroySkillBall","slumpNode","destroySlump","reduceBallCount","j","skillBallNode","ballParentChildren","_children","_name","PhysicsPolygonCollider","points","x","paddleShortSchedule","scheduleOnce","paddleLongSchedule","updateBrickSensorTrue","ballParentNode","ballNodes","children","name","brickSchedule","updateBrickSensorFalse","onBtnRank","initUserInfo","nickName","avatarUrl","a","wx","getOpenDataContext","postMessage","message","oldScore","getStorageSync","setStorageSync","setUserCloudStorage","KVDataList","key","value","success","console","log","res","openDataContext","fail","e","onBtnBack","banner","isShow","winSize","getSystemInfoSync","bannerHeight","bannerWidth","bannerAd","createBannerAd","adUnitId","style","left","windowWidth","top","windowHeight","onError","err","initVideoAd","createRewardedVideoAd","catch","load","then","onClose","isEnded","undefined","addLife"],"mappings":"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","file":"GameCtl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["/*\r\n * @Author: ayue \r\n * @Date: 2019-03-30 20:18:41 \r\n * @Last Modified by: ayue\r\n * @Last Modified time: 2019-06-19 16:04:52\r\n */\r\n\r\nconst GameModel = require('GameModel');\r\nvar Ball = require(\"Ball\");\r\nconst Slump = require('Slump');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameView: require('GameView'),\r\n        paddle: require('Paddle'),\r\n        brickLayout: require('BrickLayout'),\r\n        overPanel: require('OverPanel'),\r\n        ballPrefab: cc.Prefab,\r\n        slumpPrefab: cc.Prefab,\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        // 跳跃音效资源\r\n        collisionAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        startBackGround: cc.Node,\r\n        wxSubContextView: cc.Node,\r\n        wxBackGround: cc.Node,\r\n        allSkillBall: [],\r\n        allBall: [],\r\n        allSlump: [],\r\n        videoAd:null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        this.gameModel = new GameModel();\r\n        this.overPanel.updateGameModel(this.gameModel);\r\n        this.startGame();\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n        \r\n    },\r\n    update: function () {\r\n\r\n    },\r\n\r\n\r\n    startGame() {\r\n        this.init();\r\n        this.reBeginGame();\r\n    },\r\n    //部分属性初始化（游戏初始化时调用）\r\n    init() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameModel.init();\r\n        this.gameModel.initScore();\r\n        this.gameModel.initLevel();\r\n        this.gameModel.initLife();\r\n        this.gameModel.initLevelPosition();\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initScore();\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.paddle.init();\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n        this.overPanel.init(this);\r\n        \r\n    },\r\n    //部分属性重新初始化（在玩家仍然有机会时初始化调用）\r\n    reInit() {\r\n        this.physicsManager.enabled = true;\r\n        this.gameView.init(this);\r\n        this.gameView.init(this);\r\n        this.gameView.initLife(this.gameModel.life);\r\n        this.gameView.initLevel(this.gameModel.level);\r\n        this.createNewBall();\r\n        this.paddle.init();\r\n        this.overPanel.init(this);\r\n        this.updatePaddleShort(true);\r\n        this.updatePaddleLong(false);\r\n        this.updateBrick(false);\r\n    },\r\n    //重新绘制关卡\r\n    reInitLevelPosition() {\r\n        this.brickLayout.init(this.gameModel.bricksNumber, this.gameModel.getLevelPosition(), this.gameModel.getLevelSilveryPosition());\r\n    },\r\n    //重新开始游戏，用于还有机会的情况下\r\n    reStartGame(levelPosition) {\r\n        this.destroyAllBall();\r\n        this.reInit(levelPosition);\r\n        this.startBackGround.active = false;\r\n    },\r\n    pauseGame() {\r\n        this.physicsManager.enabled = false;\r\n    },\r\n\r\n    resumeGame() {\r\n        this.physicsManager.enabled = true;\r\n    },\r\n    //结束游戏\r\n    stopGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.show(this.gameModel.score, this.gameModel.surviveBricksNumber === 0, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //重新开始游戏（在玩家还有机会时调用）\r\n    reBeginGame() {\r\n        this.unscheduleAllCallbacks();\r\n        this.physicsManager.enabled = false;\r\n        this.overPanel.showReBegin(this.gameModel.score, this.gameModel.life, this.gameModel.level);\r\n        this.startBackGround.active = true;\r\n        this.setUserScorePassage(this.gameModel.score);\r\n    },\r\n    //小球撞击砖块处理\r\n    onBallContactBrick(ballNode, brickNode) {\r\n        //处理因为并发问题引起的砖块未打干净而结束计数的bug\r\n        if (brickNode.parent == null) {\r\n            return;\r\n        }\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        if (brickNode.life > 1) {\r\n            brickNode.life = brickNode.life - 1;\r\n        } else {\r\n            brickNode.parent = null;\r\n            brickNode.destroy();\r\n            this.gameModel.addScore(1);\r\n            // this.gameModel.minusBrick(1);\r\n            this.gameModel.minusSurviveBrick(1);\r\n            this.gameView.updateScore(this.gameModel.score);\r\n            //本关结束\r\n            if (this.gameModel.surviveBricksNumber <= 0) {\r\n                this.gameModel.addLevel();\r\n                this.overPanel.updateGameModel(this.gameModel);\r\n                this.destroyBall(ballNode);\r\n                this.reBeginGame();\r\n                this.destroyAllBall();\r\n                this.gameView.updateLevel(this.gameModel.level);\r\n            }\r\n            var dropBricks = this.gameModel.dropBricks;\r\n            for (var i = 0; i < dropBricks.length; i++) {\r\n                if (brickNode.pos == dropBricks[i]) {\r\n                    this.createSlump(brickNode.position, i);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //小球撞击地板处理\r\n    onBallContactGround(ballNode, groundNode) {\r\n        if (this.gameModel.ballCount <= 1) {\r\n            if (this.gameModel.life > 1 && this.gameModel.surviveBricksNumber > 0) {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n            } else {\r\n                this.gameModel.reduceLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.stopGame();\r\n            }\r\n            this.destroyBall(ballNode);\r\n        } else {\r\n            this.destroyBall(ballNode);\r\n        }\r\n    },\r\n    //小球撞击托盘播放音效\r\n    onBallContactPaddle(ballNode, paddleNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //小球撞击墙壁播放音效\r\n    onBallContactWall(ballNode, brickNode) {\r\n        // 播放碰撞音效\r\n        cc.audioEngine.playEffect(this.collisionAudio, false);\r\n    },\r\n    //创建新的小球\r\n    createNewBall() {\r\n        //小球复制代码\r\n        var ballNode = cc.instantiate(this.ballPrefab);\r\n        ballNode.parent = this.paddle.node.parent;\r\n        ballNode.isSkill = 0;\r\n        if (this.allBall.length > 0) {\r\n            if (this.allBall[0] != null) {\r\n                if (this.allBall[0]._color != null) {\r\n                    ballNode.color = this.allBall[0].color;\r\n                }\r\n            }\r\n        }\r\n        var Ball = ballNode.getComponent('Ball')\r\n        Ball.init(this, this.paddle.node.position);\r\n        this.gameModel.addBallCount();\r\n    },\r\n    //创建技能小球计时器\r\n    createSkillBallFactory() {\r\n        this.schedule(this.createSkillBall, 0.3, 20, 0.1);\r\n    },\r\n    //创建技能小球\r\n    createSkillBall() {\r\n            //小球复制代码\r\n        let ballNode1 = cc.instantiate(this.ballPrefab);\r\n        let collider1 = ballNode1.getComponent(cc.PhysicsCircleCollider);\r\n        collider1.radius = 6;\r\n        collider1.apply()\r\n        ballNode1.isSkill = 1;\r\n        ballNode1.parent = this.paddle.node.parent;\r\n        ballNode1.color = cc.color(209, 10, 247);\r\n        var Ball1 = ballNode1.getComponent('Ball')\r\n        Ball1.node.width=10;\r\n\r\n        let ballNode2 = cc.instantiate(this.ballPrefab);\r\n        let collider = ballNode2.getComponent(cc.PhysicsCircleCollider);\r\n        collider.radius = 6;\r\n        collider.apply()\r\n        ballNode2.isSkill = 1;\r\n        ballNode2.parent = this.paddle.node.parent;\r\n        ballNode2.color = cc.color(209, 10, 247);\r\n        var Ball = ballNode2.getComponent('Ball')\r\n        Ball.node.width =10;\r\n\r\n        Ball1.initSkillBall(this, this.paddle.node.position, \"left\");\r\n        Ball.initSkillBall(this, this.paddle.node.position, \"right\");\r\n        \r\n    },\r\n    //处理技能小球\r\n    destroySkillBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n    },\r\n    //创建掉落砖块\r\n    createSlump(position, i) {\r\n        var slumpNode = cc.instantiate(this.slumpPrefab);\r\n        slumpNode.parent = this.brickLayout.node;\r\n        var Slump = slumpNode.getComponent('Slump')\r\n        if (i % 5 == 1) {\r\n            slumpNode.color = cc.color(255, 0, 0);//红\r\n            slumpNode.type = 1;\r\n        } else if (i % 5 == 2) {\r\n            slumpNode.color = cc.color(0, 255, 255);//绿\r\n            slumpNode.type = 2;\r\n        } else if (i % 5 == 3) {\r\n            slumpNode.color = cc.color(209, 10, 247);//紫\r\n            slumpNode.type = 3;\r\n        } else if (i % 5 == 4) {\r\n            slumpNode.color = cc.color(231, 129, 0);//橙\r\n            slumpNode.type = 4;\r\n        } else {\r\n            slumpNode.type = 0;//黄\r\n        }\r\n        Slump.init(this, position);\r\n    },\r\n    //销毁掉落砖块\r\n    destroySlump(slumpNode) {\r\n        slumpNode.destroy();\r\n    },\r\n\r\n    //销毁单个小球（小球撞击地板时调用）\r\n    destroyBall(ballNode) {\r\n        ballNode.parent = null;\r\n        ballNode.destroy();\r\n        this.gameModel.reduceBallCount();\r\n    },\r\n    //销毁全部小球和掉落物（游戏结束时调用(包括有机会时)）\r\n    destroyAllBall() {\r\n        if (this.allSkillBall.length > 0) {\r\n            for (let j = 0; j < this.allSkillBall.length; j++) {\r\n                let skillBallNode = this.allSkillBall[j];\r\n                this.destroySkillBall(skillBallNode);\r\n            }\r\n            this.allSkillBall = [];\r\n        }\r\n\r\n        var ballParentChildren = this.paddle.node.parent._children;\r\n        for (var i = 0; i < ballParentChildren.length; i++) {\r\n            var node = ballParentChildren[i];\r\n            if (node._name == \"ball\") {\r\n                if (node.isSkill == 0) {\r\n                    this.destroyBall(node);\r\n                }\r\n            }\r\n        }\r\n        this.allBall = [];\r\n\r\n        if (this.allSlump.length > 0) {\r\n            for (let j = 0; j < this.allSlump.length; j++) {\r\n                let slumpNode = this.allSlump[j];\r\n                this.destroySlump(slumpNode);\r\n            }\r\n            this.allSlump = [];\r\n        }\r\n    },\r\n    //更换托盘\r\n    updatePaddleShort(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 100) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n                this.paddleShortSchedule();\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleShortSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleShort(true);\r\n        }, 10);\r\n    },\r\n\r\n    //更换托盘\r\n    updatePaddleLong(active) {\r\n        if (active == true) {\r\n            if (this.paddle.node.width < 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x * 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width * 1.5\r\n                this.paddleLongSchedule();\r\n            }\r\n        } else {\r\n            if (this.paddle.node.width > 150) {\r\n                let collider = this.paddle.node.getComponent(cc.PhysicsPolygonCollider);\r\n                for (let i = 0; i < collider.points.length; i++) {\r\n                    collider.points[i].x = collider.points[i].x / 1.5;\r\n                }\r\n                collider.apply()\r\n                this.paddle.node.width = this.paddle.node.width / 1.5\r\n\r\n            }\r\n        }\r\n    },\r\n    //托盘恢复计时器\r\n    paddleLongSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updatePaddleLong(false);\r\n        }, 10);\r\n    },\r\n    //更新砖块为有碰撞回调，有无碰撞效果\r\n    updateBrick(active) {\r\n        if (active == true) {\r\n            this.brickLayout.updateBrickSensorTrue();\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 0);\r\n                    }\r\n                }\r\n            }\r\n            this.brickSchedule();\r\n        } else {\r\n            this.brickLayout.updateBrickSensorFalse()\r\n            var ballParentNode = this.paddle.node.parent;\r\n            var ballNodes = ballParentNode.children;\r\n            for (let i = 0; i < ballNodes.length; i++) {\r\n                if (ballNodes[i].name == \"ball\") {\r\n                    if (ballNodes[i].isSkill == 0) {\r\n                        ballNodes[i].color = cc.color(255, 255, 255);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    //砖块碰撞效果恢复计时器\r\n    brickSchedule() {\r\n        this.scheduleOnce(function () {\r\n            this.updateBrick(false);\r\n        }, 10);\r\n    },\r\n\r\n    //排行榜按钮\r\n    onBtnRank() {\r\n        this.initUserInfo()\r\n    },\r\n    //初始化玩家排行榜\r\n    initUserInfo(nickName, avatarUrl) {\r\n        //权限按钮\r\n        // if(this.nickName.string == \"nickName\"){\r\n        //     let systemInfo = wx.getSystemInfoSync();\r\n        //     let width = systemInfo.windowWidth;\r\n        //     let height = systemInfo.windowHeight;\r\n        // const button = wx.createUserInfoButton({\r\n        //     type: 'text',\r\n        //     text: '',\r\n        //     style: {\r\n        //         left: 0,\r\n        //         top: 0,\r\n        //         width: width,\r\n        //         height: height,\r\n        //         lineHeight: 40,\r\n        //         backgroundColor: '#00000000',\r\n        //         color: '#00000000',\r\n        //         textAlign: 'center',\r\n        //         fontSize: 10,\r\n        //         borderRadius: 4\r\n        //     }\r\n        // })\r\n        //\r\n        // button.onTap((res) => {\r\n        //     let userInfo = res.userInfo;\r\n        //     this.nickName.string = userInfo.nickName;\r\n        //     cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\r\n        //         if (err) {\r\n        //             console.error(err);\r\n        //             return;\r\n        //         }\r\n        //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\r\n        //     });\r\n        //     button.hide();\r\n        //     button.destroy();\r\n        //\r\n        // })\r\n        // }\r\n        this.wxSubContextView.active = true;\r\n        this.wxBackGround.active = true;\r\n        let a = wx.getOpenDataContext().postMessage({\r\n            message: \"User info get success.\"\r\n        });\r\n    },\r\n    //上传玩家得分\r\n    setUserScorePassage(score) {\r\n        try {\r\n            const oldScore = wx.getStorageSync('maxScore') || 0;\r\n            if (oldScore < score) {\r\n                try {\r\n                    wx.setStorageSync('maxScore', score);\r\n                    wx.setUserCloudStorage({\r\n                        KVDataList: [{ key: \"score\", value: score + \"\" }],\r\n                        success: res => {\r\n                            console.log(res);\r\n                            // 让子域更新当前用户的最高分，因为主域无法得到getUserCloadStorage;\r\n                            let openDataContext = wx.getOpenDataContext();\r\n                            openDataContext.postMessage({\r\n                                type: 'updateMaxScore',\r\n                            });\r\n                        },\r\n                        fail: res => {\r\n                            console.log(res);\r\n                        }\r\n                    });\r\n                } catch (e) {\r\n                    console.log(\"数据存储失败\")\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.log(\"获取数据存储失败\")\r\n        }\r\n    },\r\n\r\n    //排行榜返回按钮\r\n    onBtnBack() {\r\n        this.wxSubContextView.active = false;\r\n        this.wxBackGround.active = false;\r\n    },\r\n    banner(isShow){\r\n        if(isShow == true){\r\n            let winSize = wx.getSystemInfoSync();\r\n            let bannerHeight = 135;\r\n            let bannerWidth = 360;\r\n            // 创建 Banner 广告实例，提前初始化\r\n            if(this.bannerAd==null){\r\n                this.bannerAd = wx.createBannerAd({\r\n                    adUnitId: 'adunit-256c6c4d51b28192',\r\n                    style: {\r\n                        left: (winSize.windowWidth-bannerWidth)/2+0.1,\r\n                        top: winSize.windowHeight - bannerHeight-30,\r\n                        width: bannerWidth,\r\n                    }\r\n                })\r\n                // 在适合的场景显示 Banner 广告\r\n                this.bannerAd.show();\r\n                this.bannerAd.onError(err => {\r\n                    console.log(\"广告拉取错误\");\r\n                    console.log(err);\r\n                  })\r\n            }else{\r\n                this.bannerAd.destroy();\r\n                this.bannerAd = null;\r\n            }\r\n        }else{\r\n            if(this.bannerAd!=null){\r\n                this.bannerAd.destroy();\r\n                this.bannerAd = null;\r\n            }\r\n        }\r\n    },\r\n\r\n    initVideoAd(){\r\n        //实例\r\n\t\t// 创建激励视频广告实例，提前初始化\r\n        let videoAd = wx.createRewardedVideoAd({\r\n            adUnitId: 'adunit-97d79c620e54fee7'\r\n        })\r\n  \r\n\t\tthis.videoAd = videoAd;\r\n        // 用户触发广告后，显示激励视频广告\r\n        this.videoAd.show().catch(() => {\r\n        // 失败重试\r\n            this.videoAd.load()\r\n            .then(() => this.videoAd.show())\r\n            .catch(err => {\r\n                console.log('激励视频 广告显示失败')\r\n            })\r\n        })\r\n        //捕捉错误\r\n\t\tthis.videoAd.onError(err => {\r\n\t\t\tconsole.log(err)\r\n\t\t})\r\n\r\n\t\t//关闭视频的回调函数\r\n\t\tthis.videoAd.onClose(res => {\r\n\t\t\t// 用户点击了【关闭广告】按钮\r\n\t\t\t// 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n\t\t\tconsole.log(res)\r\n\t\t\tif (res && res.isEnded || res === undefined) {\r\n                this.gameModel.addLife();\r\n                this.gameView.updateLife(this.gameModel.life)\r\n                this.overPanel.updateGameModel(this.gameModel)\r\n                this.reBeginGame();\r\n                this.banner(true);\r\n\t\t\t} else {\r\n                // 播放中途退出，不下发游戏奖励\r\n                this.banner(true);\r\n\t\t\t}\r\n\t\t})\r\n\r\n    },\r\n   // login(){\r\n    //     var isUserInfo = false;\r\n    //     var newUserInfo  = null;\r\n    //     wx.getSetting({\r\n    //         success (res) {\r\n    //           console.log(res.authSetting)\r\n    //           isUserInfo = res.authSetting['scope.userInfo'];\r\n    //           console.log(isUserInfo);\r\n    //           if(!isUserInfo){\r\n    //             let button = wx.createUserInfoButton({\r\n    //                 type: 'text',\r\n    //                 text: '获取用户信息',\r\n    //                 style: {\r\n    //                   left: 100,\r\n    //                   top: 525,\r\n    //                   width: 200,\r\n    //                   height: 40,\r\n    //                   lineHeight: 40,\r\n    //                   backgroundColor: '#ff0000',\r\n    //                   color: '#ffffff',\r\n    //                   textAlign: 'center',\r\n    //                   fontSize: 16,\r\n    //                   borderRadius: 4\r\n    //                 }\r\n    //               })\r\n    //               button.onTap((res) => {\r\n    //                 console.log(res)\r\n    //                 button.destroy();\r\n    //               })\r\n    //           }else{\r\n    //             wx.getUserInfo({\r\n    //                 success: function(res) {\r\n    //                   var userInfo = res.userInfo\r\n    //                   var nickName = userInfo.nickName\r\n    //                   var avatarUrl = userInfo.avatarUrl\r\n    //                   var gender = userInfo.gender //性别 0：未知、1：男、2：女\r\n    //                   var province = userInfo.province\r\n    //                   var city = userInfo.city\r\n    //                   var country = userInfo.country\r\n    //                   newUserInfo = userInfo\r\n    //                   console.log(userInfo);\r\n    //                   console.log(newUserInfo);\r\n\r\n    //                   //发起网络请求\r\n    //                     wx.request({\r\n    //                         url: 'https://api.weixin.qq.com/sns/jscode2session',\r\n    //                         data:{\r\n    //                             appid:AppId,\r\n    //                             secret:AppSecret,\r\n    //                             js_code:res.code,\r\n    //                             grant_type:'authorization_code'\r\n    //                         },\r\n    //                         header: {  \r\n    //                             \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n    //                         }, \r\n    //                         method: 'GET', \r\n    //                         success: function(res){\r\n    //                             var pc = new WXBizDataCrypt(AppId, res.data.session_key)\r\n    //                             wx.getUserInfo({\r\n    //                             success: function (res) {\r\n    //                                 var data = pc.decryptData(res.encryptedData , res.iv)\r\n    //                                 console.log('解密后 data: ', data)\r\n    //                             }\r\n    //                             })\r\n    //                         },\r\n    //                         fail: function(res) {},\r\n    //                         complete: function(res) {}\r\n    //                     });\r\n    //                 }\r\n    //               })\r\n    //           }\r\n    //           // res.authSetting = {\r\n    //           //   \"scope.userInfo\": true,\r\n    //           //   \"scope.userLocation\": true\r\n    //           // }\r\n              \r\n    //         }\r\n            \r\n    //       })\r\n\r\n        \r\n    // },\r\n\r\n});"]}